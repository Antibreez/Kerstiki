!function(){var e=document.querySelector(".field"),t=document.querySelectorAll(".field__cell"),n=document.querySelector(".gameover"),r=document.querySelector(".gameover__text"),o=document.querySelector(".gameover__close"),i=document.querySelector(".gameover__to-start"),c=document.querySelector(".begin"),s=document.querySelector(".begin__button--multiplayer"),u=document.querySelector(".begin__button--one-player-cross"),l=document.querySelector(".begin__button--one-player-ring"),d=document.querySelector("#cross").content.querySelector(".cross"),a=document.querySelector("#ring").content.querySelector(".ring"),f=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],m={cross:"Выиграли крестики!",ring:"Выиграли нолики!",tie:"Ничья!"},v="tie",h=!0,y=!1,_=!1,L=0,p=function(){var e=h?d.cloneNode(!0):a.cloneNode(!0);return h=!h,e},g=function(e){return t[e].firstChild?t[e].firstChild.classList[0]:"empty"},q=function(){var e=!1;return f.forEach((function(t){(function(e){var t=!1;return"empty"!==g(e[0])&&g(e[0])===g(e[1])&&g(e[0])===g(e[2])&&(v=g(e[0]),t=!0),t})(t)&&!e&&(e=!0)})),e},S=function(e){var t=-1;return f.forEach((function(n){var r=function(e,t){return g(e[0])===t&&g(e[0])===g(e[1])&&"empty"===g(e[2])?e[2]:g(e[0])===t&&g(e[0])===g(e[2])&&"empty"===g(e[1])?e[1]:g(e[1])===t&&g(e[1])===g(e[2])&&"empty"===g(e[0])?e[0]:-1}(n,e);-1!==r&&-1===t&&(t=r)})),t},C=function(){var e,n,r=S("cross"),o=S("ring"),i=-1;if(-1!==o)return t[o].appendChild(p()),void(L+=1);if(-1!==r)return t[r].appendChild(p()),void(L+=1);for(;-1===i;)num=(e=0,n=8,Math.floor(Math.random()*(n-e+1))+e),i=t[num].firstChild?-1:num;t[i].appendChild(p()),L+=1},E=function(){r.className="gameover__text",r.classList.add(v),r.textContent=m[v],n.classList.add("show")},w=function(){t.forEach((function(e){e.firstChild&&e.removeChild(e.firstChild)}))};c.classList.add("show"),s.addEventListener("click",(function(){c.classList.remove("show"),y=!0})),u.addEventListener("click",(function(){c.classList.remove("show")})),l.addEventListener("click",(function(){c.classList.remove("show"),_=!0,C()})),e.addEventListener("click",(function(e){var t=e.target;if(t.classList.contains("field__cell")){if(t.appendChild(p()),L+=1,q())return void E();if(9===L)return void E();if(!y){if(C(),q())return void E();9===L&&E()}}})),o.addEventListener("click",(function(){w(),n.classList.remove("show"),r.textContent="",h=!0,v="tie",L=0,_&&C()})),i.addEventListener("click",(function(){_=!1,y=!1,n.classList.remove("show"),w(),r.textContent="",h=!0,v="tie",L=0,c.classList.add("show")}))}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiZmllbGQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjZWxscyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJnYW1lb3ZlciIsIm1lc3NhZ2UiLCJjbG9zZSIsIm1lbnUiLCJiZWdpbiIsIm11bHRpcGxheWVyIiwiY3Jvc3NQbGF5ZXIiLCJyaW5nUGxheWVyIiwiY3Jvc3NUZW1wbGF0ZSIsImNvbnRlbnQiLCJyaW5nVGVtcGxhdGUiLCJMSU5FUyIsIldJTl9NRVNTQUdFIiwiY3Jvc3MiLCJyaW5nIiwidGllIiwid2lubmVyIiwiaXNDcm9zcyIsImlzTXVsdGlwbGF5ZXIiLCJpc1JpbmdQbGF5ZXIiLCJzdGVwIiwicmVuZGVyIiwibm9kZSIsImNsb25lTm9kZSIsImdldENlbGxOYW1lIiwibnVtIiwiZmlyc3RDaGlsZCIsImNsYXNzTGlzdCIsImNoZWNrRW5kIiwiaXNFbmQiLCJmb3JFYWNoIiwibGluZSIsImlzQWxsU2FtZSIsImNoZWNrRnVsbExpbmUiLCJnZXRQb3NzaWJsZUZpZWxkQ2VsbCIsInBsYXllciIsImNlbGwiLCJjdXJyZW50Q2VsbCIsImdldFBvc3NpYmxlTGluZUNlbGwiLCJjb21wdXRlck1vdmUiLCJtaW4iLCJtYXgiLCJkYW5nZXJOdW0iLCJ3aW5uaW5nTnVtIiwicmFuZG9tTnVtIiwiYXBwZW5kQ2hpbGQiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJzaG93TWVzc2FnZSIsImNsYXNzTmFtZSIsImFkZCIsInRleHRDb250ZW50IiwiY2xlYXJGaWVsZCIsInJlbW92ZUNoaWxkIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZSIsImV2dCIsInRhcmdldCIsImNvbnRhaW5zIl0sIm1hcHBpbmdzIjoiQ0FBQSxXQUNBLElBQUFBLEVBQUFDLFNBQUFDLGNBQUEsVUFDQUMsRUFBQUYsU0FBQUcsaUJBQUEsZ0JBQ0FDLEVBQUFKLFNBQUFDLGNBQUEsYUFDQUksRUFBQUwsU0FBQUMsY0FBQSxtQkFDQUssRUFB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ICB2YXIgZmllbGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZmllbGQnKTtcbiAgdmFyIGNlbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZpZWxkX19jZWxsJyk7XG4gIHZhciBnYW1lb3ZlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5nYW1lb3ZlcicpO1xuICB2YXIgbWVzc2FnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5nYW1lb3Zlcl9fdGV4dCcpO1xuICB2YXIgY2xvc2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ2FtZW92ZXJfX2Nsb3NlJyk7XG4gIHZhciBtZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdhbWVvdmVyX190by1zdGFydCcpO1xuXG4gIHZhciBiZWdpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5iZWdpbicpO1xuICB2YXIgbXVsdGlwbGF5ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmVnaW5fX2J1dHRvbi0tbXVsdGlwbGF5ZXInKTtcbiAgdmFyIGNyb3NzUGxheWVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJlZ2luX19idXR0b24tLW9uZS1wbGF5ZXItY3Jvc3MnKTtcbiAgdmFyIHJpbmdQbGF5ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmVnaW5fX2J1dHRvbi0tb25lLXBsYXllci1yaW5nJyk7XG5cbiAgdmFyIGNyb3NzVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY3Jvc3MnKS5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoJy5jcm9zcycpO1xuICB2YXIgcmluZ1RlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3JpbmcnKS5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoJy5yaW5nJyk7XG5cbiAgdmFyIExJTkVTID0gW1xuICAgIFswLCAxLCAyXSxcbiAgICBbMywgNCwgNV0sXG4gICAgWzYsIDcsIDhdLFxuICAgIFswLCAzLCA2XSxcbiAgICBbMSwgNCwgN10sXG4gICAgWzIsIDUsIDhdLFxuICAgIFswLCA0LCA4XSxcbiAgICBbMiwgNCwgNl1cbiAgXTtcblxuICB2YXIgV0lOX01FU1NBR0UgPSB7XG4gICAgJ2Nyb3NzJzogJ9CS0YvQuNCz0YDQsNC70Lgg0LrRgNC10YHRgtC40LrQuCEnLFxuICAgICdyaW5nJzogJ9CS0YvQuNCz0YDQsNC70Lgg0L3QvtC70LjQutC4IScsXG4gICAgJ3RpZSc6ICfQndC40YfRjNGPISdcbiAgfTtcblxuICB2YXIgd2lubmVyID0gJ3RpZSc7XG4gIHZhciBjb21wdXRlciA9ICdyaW5nJztcbiAgdmFyIGh1bWFuID0gJ2Nyb3NzJztcbiAgdmFyIGlzQ3Jvc3MgPSB0cnVlO1xuICB2YXIgaXNNdWx0aXBsYXllciA9IGZhbHNlO1xuICB2YXIgaXNSaW5nUGxheWVyID0gZmFsc2U7XG4gIHZhciBzdGVwID0gMDtcblxuICB2YXIgZ2V0UmFuZG9tTnVtYmVyID0gZnVuY3Rpb24gKG1pbiwgbWF4KSB7XG4gICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSkgKyBtaW47XG4gIH07XG5cbiAgdmFyIG9uTXVsdGlwbGF5ZXJDbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICBiZWdpbi5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG4gICAgaXNNdWx0aXBsYXllciA9IHRydWU7XG4gIH07XG5cbiAgdmFyIG9uQ3Jvc3NQbGF5ZXJDbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICBiZWdpbi5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG4gIH07XG5cbiAgdmFyIG9uUmluZ1BsYXllckNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgIGJlZ2luLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTtcbiAgICBpc1JpbmdQbGF5ZXIgPSB0cnVlO1xuICAgIGNvbXB1dGVyTW92ZSgpO1xuICB9O1xuXG4gIHZhciBjaGFuZ2VQbGF5ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgaXNDcm9zcyA9IGlzQ3Jvc3MgPyBmYWxzZSA6IHRydWU7XG4gIH07XG5cbiAgdmFyIHJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbm9kZSA9IGlzQ3Jvc3MgP1xuICAgICAgY3Jvc3NUZW1wbGF0ZS5jbG9uZU5vZGUodHJ1ZSkgOlxuICAgICAgcmluZ1RlbXBsYXRlLmNsb25lTm9kZSh0cnVlKTtcbiAgICBjaGFuZ2VQbGF5ZXIoKTtcblxuICAgIHJldHVybiBub2RlO1xuICB9O1xuXG4gIHZhciBnZXRDZWxsTmFtZSA9IGZ1bmN0aW9uIChudW0pIHtcbiAgICByZXR1cm4gY2VsbHNbbnVtXS5maXJzdENoaWxkID9cbiAgICAgIGNlbGxzW251bV0uZmlyc3RDaGlsZC5jbGFzc0xpc3RbMF0gOlxuICAgICAgJ2VtcHR5JztcbiAgfTtcblxuICB2YXIgY2hlY2tGdWxsTGluZSA9IGZ1bmN0aW9uIChsaW5lKSB7XG4gICAgdmFyIGlzQWxsU2FtZSA9IGZhbHNlO1xuXG4gICAgaWYgKFxuICAgICAgZ2V0Q2VsbE5hbWUobGluZVswXSkgIT09ICdlbXB0eSdcbiAgICAgICYmIGdldENlbGxOYW1lKGxpbmVbMF0pID09PSBnZXRDZWxsTmFtZShsaW5lWzFdKVxuICAgICAgJiYgZ2V0Q2VsbE5hbWUobGluZVswXSkgPT09IGdldENlbGxOYW1lKGxpbmVbMl0pXG4gICAgKSB7XG4gICAgICB3aW5uZXIgPSBnZXRDZWxsTmFtZShsaW5lWzBdKTtcbiAgICAgIGlzQWxsU2FtZSA9IHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGlzQWxsU2FtZTtcbiAgfTtcblxuICB2YXIgY2hlY2tFbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGlzRW5kID0gZmFsc2U7XG5cbiAgICBMSU5FUy5mb3JFYWNoKGZ1bmN0aW9uIChsaW5lKSB7XG4gICAgICBpZiAoY2hlY2tGdWxsTGluZShsaW5lKSAmJiAhaXNFbmQpIHtcbiAgICAgICAgaXNFbmQgPSB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGlzRW5kO1xuICB9O1xuXG4gIHZhciBnZXRQb3NzaWJsZUxpbmVDZWxsID0gZnVuY3Rpb24gKGxpbmUsIHBsYXllcikge1xuICAgIGlmIChcbiAgICAgIGdldENlbGxOYW1lKGxpbmVbMF0pID09PSBwbGF5ZXJcbiAgICAgICYmIGdldENlbGxOYW1lKGxpbmVbMF0pID09PSBnZXRDZWxsTmFtZShsaW5lWzFdKVxuICAgICAgJiYgZ2V0Q2VsbE5hbWUobGluZVsyXSkgPT09ICdlbXB0eSdcbiAgICApIHtcbiAgICAgIHJldHVybiBsaW5lWzJdO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIGdldENlbGxOYW1lKGxpbmVbMF0pID09PSBwbGF5ZXJcbiAgICAgICYmIGdldENlbGxOYW1lKGxpbmVbMF0pID09PSBnZXRDZWxsTmFtZShsaW5lWzJdKVxuICAgICAgJiYgZ2V0Q2VsbE5hbWUobGluZVsxXSkgPT09ICdlbXB0eSdcbiAgICApIHtcbiAgICAgIHJldHVybiBsaW5lWzFdO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIGdldENlbGxOYW1lKGxpbmVbMV0pID09PSBwbGF5ZXJcbiAgICAgICYmIGdldENlbGxOYW1lKGxpbmVbMV0pID09PSBnZXRDZWxsTmFtZShsaW5lWzJdKVxuICAgICAgJiYgZ2V0Q2VsbE5hbWUobGluZVswXSkgPT09ICdlbXB0eSdcbiAgICApIHtcbiAgICAgIHJldHVybiBsaW5lWzBdO1xuICAgIH1cblxuICAgIHJldHVybiAtMTtcbiAgfTtcblxuICB2YXIgZ2V0UG9zc2libGVGaWVsZENlbGwgPSBmdW5jdGlvbiAocGxheWVyKSB7XG4gICAgdmFyIGNlbGwgPSAtMTtcblxuICAgIExJTkVTLmZvckVhY2goZnVuY3Rpb24gKGxpbmUpIHtcbiAgICAgIHZhciBjdXJyZW50Q2VsbCA9IGdldFBvc3NpYmxlTGluZUNlbGwobGluZSwgcGxheWVyKTtcblxuICAgICAgaWYgKGN1cnJlbnRDZWxsICE9PSAtMSAmJiBjZWxsID09PSAtMSkge1xuICAgICAgICBjZWxsID0gY3VycmVudENlbGw7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gY2VsbDtcbiAgfTtcblxuICB2YXIgY29tcHV0ZXJNb3ZlID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBkYW5nZXJOdW0gPSBnZXRQb3NzaWJsZUZpZWxkQ2VsbChodW1hbik7XG4gICAgdmFyIHdpbm5pbmdOdW0gPSBnZXRQb3NzaWJsZUZpZWxkQ2VsbChjb21wdXRlcik7XG4gICAgdmFyIHJhbmRvbU51bSA9IC0xO1xuXG4gICAgaWYgKHdpbm5pbmdOdW0gIT09IC0xKSB7XG4gICAgICBjZWxsc1t3aW5uaW5nTnVtXS5hcHBlbmRDaGlsZChyZW5kZXIoKSk7XG4gICAgICBzdGVwICs9IDE7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGRhbmdlck51bSAhPT0gLTEpIHtcbiAgICAgIGNlbGxzW2Rhbmdlck51bV0uYXBwZW5kQ2hpbGQocmVuZGVyKCkpO1xuICAgICAgc3RlcCArPSAxO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHdoaWxlIChyYW5kb21OdW0gPT09IC0xKSB7XG4gICAgICBudW0gPSBnZXRSYW5kb21OdW1iZXIoMCwgOCk7XG4gICAgICByYW5kb21OdW0gPSBjZWxsc1tudW1dLmZpcnN0Q2hpbGQgPyAtMSA6IG51bTtcbiAgICB9XG5cbiAgICBjZWxsc1tyYW5kb21OdW1dLmFwcGVuZENoaWxkKHJlbmRlcigpKTtcbiAgICBzdGVwICs9IDE7XG4gIH1cblxuICB2YXIgc2hvd01lc3NhZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgbWVzc2FnZS5jbGFzc05hbWUgPSAnZ2FtZW92ZXJfX3RleHQnO1xuICAgIG1lc3NhZ2UuY2xhc3NMaXN0LmFkZCh3aW5uZXIpO1xuICAgIG1lc3NhZ2UudGV4dENvbnRlbnQgPSBXSU5fTUVTU0FHRVt3aW5uZXJdO1xuICAgIGdhbWVvdmVyLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTtcbiAgfTtcblxuICB2YXIgY2xlYXJGaWVsZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBjZWxscy5mb3JFYWNoKGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICBpZiAoY2VsbC5maXJzdENoaWxkKSB7XG4gICAgICAgIGNlbGwucmVtb3ZlQ2hpbGQoY2VsbC5maXJzdENoaWxkKTtcbiAgICAgIH1cbiAgICB9KVxuICB9O1xuXG4gIHZhciBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgY2xlYXJGaWVsZCgpO1xuICAgIGdhbWVvdmVyLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTtcbiAgICBtZXNzYWdlLnRleHRDb250ZW50ID0gJyc7XG4gICAgaXNDcm9zcyA9IHRydWU7XG4gICAgd2lubmVyID0gJ3RpZSc7XG4gICAgc3RlcCA9IDA7XG5cbiAgICBpZiAoaXNSaW5nUGxheWVyKSB7XG4gICAgICBjb21wdXRlck1vdmUoKTtcbiAgICB9XG4gIH07XG5cbiAgdmFyIG9uTWVudUNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgIGlzUmluZ1BsYXllciA9IGZhbHNlO1xuICAgIGlzTXVsdGlwbGF5ZXIgPSBmYWxzZTtcbiAgICBnYW1lb3Zlci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG4gICAgY2xlYXJGaWVsZCgpO21lc3NhZ2UudGV4dENvbnRlbnQgPSAnJztcbiAgICBpc0Nyb3NzID0gdHJ1ZTtcbiAgICB3aW5uZXIgPSAndGllJztcbiAgICBzdGVwID0gMDtcblxuICAgIGJlZ2luLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTtcbiAgfVxuXG4gIHZhciBvbkZpZWxkQ2xpY2sgPSBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgdmFyIHRhcmdldCA9IGV2dC50YXJnZXQ7XG5cbiAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZmllbGRfX2NlbGwnKSkge1xuICAgICAgdGFyZ2V0LmFwcGVuZENoaWxkKHJlbmRlcigpKTtcbiAgICAgIHN0ZXAgKz0gMTtcblxuICAgICAgaWYgKGNoZWNrRW5kKCkpIHtcbiAgICAgICAgc2hvd01lc3NhZ2UoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoc3RlcCA9PT0gOSkge1xuICAgICAgICBzaG93TWVzc2FnZSgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICghaXNNdWx0aXBsYXllcikge1xuICAgICAgICBjb21wdXRlck1vdmUoKTtcblxuICAgICAgICBpZiAoY2hlY2tFbmQoKSkge1xuICAgICAgICAgIHNob3dNZXNzYWdlKCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHN0ZXAgPT09IDkpIHtcbiAgICAgICAgICBzaG93TWVzc2FnZSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgYmVnaW4uY2xhc3NMaXN0LmFkZCgnc2hvdycpO1xuICBtdWx0aXBsYXllci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uTXVsdGlwbGF5ZXJDbGljayk7XG4gIGNyb3NzUGxheWVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25Dcm9zc1BsYXllckNsaWNrKTtcbiAgcmluZ1BsYXllci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uUmluZ1BsYXllckNsaWNrKTtcbiAgZmllbGQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkZpZWxkQ2xpY2spO1xuICBjbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xvc2VDbGljayk7XG4gIG1lbnUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbk1lbnVDbGljayk7XG59KSgpO1xuIl19
