!function(){var e=document.querySelector(".field"),t=document.querySelectorAll(".field__cell"),n=document.querySelector(".gameover"),r=document.querySelector(".gameover__text"),o=document.querySelector(".gameover__close"),i=document.querySelector(".gameover__to-start"),c=document.querySelector(".begin"),s=document.querySelector(".begin__button--multiplayer"),u=document.querySelector(".begin__button--one-player-cross"),l=document.querySelector(".begin__button--one-player-ring"),d=document.querySelector("#cross").content.querySelector(".cross"),a=document.querySelector("#ring").content.querySelector(".ring"),f=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],m=!1,v={cross:"Выиграли крестики!",ring:"Выиграли нолики!",tie:"Ничья!"},h="tie",y="ring",_="cross",g=!0,L=!1,p=!1,q=0,S=function(){var e=g?d.cloneNode(!0):a.cloneNode(!0);return g=!g,e},C=function(e){return t[e].firstChild?t[e].firstChild.classList[0]:"empty"},E=function(){var e=!1;return f.forEach((function(t){(function(e){var t=!1;return"empty"!==C(e[0])&&C(e[0])===C(e[1])&&C(e[0])===C(e[2])&&(h=C(e[0]),t=!0),t})(t)&&!e&&(e=!0)})),e},w=function(e){var t=-1;return f.forEach((function(n){var r=function(e,t){return C(e[0])===t&&C(e[0])===C(e[1])&&"empty"===C(e[2])?e[2]:C(e[0])===t&&C(e[0])===C(e[2])&&"empty"===C(e[1])?e[1]:C(e[1])===t&&C(e[1])===C(e[2])&&"empty"===C(e[0])?e[0]:-1}(n,e);-1!==r&&-1===t&&(t=r)})),t},b=function(){var e,n,r=w(_),o=w(y),i=-1;if(m=!1,-1!==o)return t[o].appendChild(S()),void(q+=1);if(-1!==r)return t[r].appendChild(S()),void(q+=1);for(;-1===i;)num=(e=0,n=8,Math.floor(Math.random()*(n-e+1))+e),i=t[num].firstChild?-1:num;t[i].appendChild(S()),q+=1,(E()||9===q)&&k()},k=function(){r.className="gameover__text",r.classList.add(h),r.textContent=v[h],n.classList.add("show")},x=function(){t.forEach((function(e){e.firstChild&&e.removeChild(e.firstChild)}))};c.classList.add("show"),s.addEventListener("click",(function(){c.classList.remove("show"),L=!0})),u.addEventListener("click",(function(){c.classList.remove("show")})),l.addEventListener("click",(function(){c.classList.remove("show"),p=!0,y="cross",_="ring",setTimeout(b,500)})),e.addEventListener("click",(function(e){var t=e.target;if(t.classList.contains("field__cell")&&!m){if(m=!L,t.appendChild(S()),q+=1,E())return void k();if(9===q)return void k();L||setTimeout(b,500)}})),o.addEventListener("click",(function(){x(),n.classList.remove("show"),r.textContent="",g=!0,h="tie",q=0,m=!1,p&&setTimeout(b,500)})),i.addEventListener("click",(function(){p=!1,L=!1,n.classList.remove("show"),x(),r.textContent="",g=!0,h="tie",q=0,m=!1,y="ring",_="cross",c.classList.add("show")}))}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiZmllbGQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjZWxscyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJnYW1lb3ZlciIsIm1lc3NhZ2UiLCJjbG9zZSIsIm1lbnUiLCJiZWdpbiIsIm11bHRpcGxheWVyIiwiY3Jvc3NQbGF5ZXIiLCJyaW5nUGxheWVyIiwiY3Jvc3NUZW1wbGF0ZSIsImNvbnRlbnQiLCJyaW5nVGVtcGxhdGUiLCJMSU5FUyIsImlzRGVsYXkiLCJXSU5fTUVTU0FHRSIsImNyb3NzIiwicmluZyIsInRpZSIsIndpbm5lciIsImNvbXB1dGVyIiwiaHVtYW4iLCJpc0Nyb3NzIiwiaXNNdWx0aXBsYXllciIsImlzUmluZ1BsYXllciIsInN0ZXAiLCJyZW5kZXIiLCJub2RlIiwiY2xvbmVOb2RlIiwiZ2V0Q2VsbE5hbWUiLCJudW0iLCJmaXJzdENoaWxkIiwiY2xhc3NMaXN0IiwiY2hlY2tFbmQiLCJpc0VuZCIsImZvckVhY2giLCJsaW5lIiwiaXNBbGxTYW1lIiwiY2hlY2tGdWxsTGluZSIsImdldFBvc3NpYmxlRmllbGRDZWxsIiwicGxheWVyIiwiY2VsbCIsImN1cnJlbnRDZWxsIiwiZ2V0UG9zc2libGVMaW5lQ2VsbCIsImNvbXB1dGVyTW92ZSIsIm1pbiIsIm1heCIsImRhbmdlck51bSIsIndpbm5pbmdOdW0iLCJyYW5kb21OdW0iLCJhcHBlbmRDaGlsZCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInNob3dNZXNzYWdlIiwiY2xhc3NOYW1lIiwiYWRkIiwidGV4dENvbnRlbnQiLCJjbGVhckZpZWxkIiwicmVtb3ZlQ2hpbGQiLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlIiwic2V0VGltZW91dCIsImV2dCIsInRhcmdldCIsImNvbnRhaW5zIl0sIm1hcHBpbmdzIjoiQ0FBQSxXQUNBLElBQUFBLEVBQUFDLFNBQUFDLGNBQUEsVUFDQUMsRUFBQUYsU0FBQUcsaUJBQUEsZ0JBQ0FDLEVBQUFKLFNB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QUE2QixPQUFBLFFBQ0FILElBQUF2RCxFQUFBc0QsWUFBQSxHQUNBbkMsR0FBQSxFQUNBSCxFQUFBLE1BQ0FNLEVBQUEsRUFDQVgsR0FBQSxFQUNBTSxFQUFBLE9BQ0FDLEVBQUEsUUFFQWYsRUFBQTBCLFVBQUF3QixJQUFBLFdBeE9BIiwiZmlsZSI6InNjcmlwdC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICB2YXIgZmllbGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZmllbGQnKTtcbiAgdmFyIGNlbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZpZWxkX19jZWxsJyk7XG4gIHZhciBnYW1lb3ZlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5nYW1lb3ZlcicpO1xuICB2YXIgbWVzc2FnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5nYW1lb3Zlcl9fdGV4dCcpO1xuICB2YXIgY2xvc2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ2FtZW92ZXJfX2Nsb3NlJyk7XG4gIHZhciBtZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdhbWVvdmVyX190by1zdGFydCcpO1xuXG4gIHZhciBiZWdpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5iZWdpbicpO1xuICB2YXIgbXVsdGlwbGF5ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmVnaW5fX2J1dHRvbi0tbXVsdGlwbGF5ZXInKTtcbiAgdmFyIGNyb3NzUGxheWVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJlZ2luX19idXR0b24tLW9uZS1wbGF5ZXItY3Jvc3MnKTtcbiAgdmFyIHJpbmdQbGF5ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmVnaW5fX2J1dHRvbi0tb25lLXBsYXllci1yaW5nJyk7XG5cbiAgdmFyIGNyb3NzVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY3Jvc3MnKS5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoJy5jcm9zcycpO1xuICB2YXIgcmluZ1RlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3JpbmcnKS5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoJy5yaW5nJyk7XG5cbiAgdmFyIExJTkVTID0gW1xuICAgIFswLCAxLCAyXSxcbiAgICBbMywgNCwgNV0sXG4gICAgWzYsIDcsIDhdLFxuICAgIFswLCAzLCA2XSxcbiAgICBbMSwgNCwgN10sXG4gICAgWzIsIDUsIDhdLFxuICAgIFswLCA0LCA4XSxcbiAgICBbMiwgNCwgNl1cbiAgXTtcblxuICB2YXIgREVMQVkgPSA1MDA7XG5cbiAgdmFyIGlzRGVsYXkgPSBmYWxzZTtcblxuICB2YXIgV0lOX01FU1NBR0UgPSB7XG4gICAgJ2Nyb3NzJzogJ9CS0YvQuNCz0YDQsNC70Lgg0LrRgNC10YHRgtC40LrQuCEnLFxuICAgICdyaW5nJzogJ9CS0YvQuNCz0YDQsNC70Lgg0L3QvtC70LjQutC4IScsXG4gICAgJ3RpZSc6ICfQndC40YfRjNGPISdcbiAgfTtcblxuICB2YXIgd2lubmVyID0gJ3RpZSc7XG4gIHZhciBjb21wdXRlciA9ICdyaW5nJztcbiAgdmFyIGh1bWFuID0gJ2Nyb3NzJztcbiAgdmFyIGlzQ3Jvc3MgPSB0cnVlO1xuICB2YXIgaXNNdWx0aXBsYXllciA9IGZhbHNlO1xuICB2YXIgaXNSaW5nUGxheWVyID0gZmFsc2U7XG4gIHZhciBzdGVwID0gMDtcblxuICB2YXIgZ2V0UmFuZG9tTnVtYmVyID0gZnVuY3Rpb24gKG1pbiwgbWF4KSB7XG4gICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSkgKyBtaW47XG4gIH07XG5cbiAgdmFyIG9uTXVsdGlwbGF5ZXJDbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICBiZWdpbi5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG4gICAgaXNNdWx0aXBsYXllciA9IHRydWU7XG4gIH07XG5cbiAgdmFyIG9uQ3Jvc3NQbGF5ZXJDbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICBiZWdpbi5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG4gIH07XG5cbiAgdmFyIG9uUmluZ1BsYXllckNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgIGJlZ2luLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTtcbiAgICBpc1JpbmdQbGF5ZXIgPSB0cnVlO1xuICAgIGNvbXB1dGVyID0gJ2Nyb3NzJztcbiAgICBodW1hbiA9ICdyaW5nJztcbiAgICBzZXRUaW1lb3V0KGNvbXB1dGVyTW92ZSwgREVMQVkpO1xuICB9O1xuXG4gIHZhciBjaGFuZ2VQbGF5ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgaXNDcm9zcyA9IGlzQ3Jvc3MgPyBmYWxzZSA6IHRydWU7XG4gIH07XG5cbiAgdmFyIHJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbm9kZSA9IGlzQ3Jvc3MgP1xuICAgICAgY3Jvc3NUZW1wbGF0ZS5jbG9uZU5vZGUodHJ1ZSkgOlxuICAgICAgcmluZ1RlbXBsYXRlLmNsb25lTm9kZSh0cnVlKTtcbiAgICBjaGFuZ2VQbGF5ZXIoKTtcblxuICAgIHJldHVybiBub2RlO1xuICB9O1xuXG4gIHZhciBnZXRDZWxsTmFtZSA9IGZ1bmN0aW9uIChudW0pIHtcbiAgICByZXR1cm4gY2VsbHNbbnVtXS5maXJzdENoaWxkID9cbiAgICAgIGNlbGxzW251bV0uZmlyc3RDaGlsZC5jbGFzc0xpc3RbMF0gOlxuICAgICAgJ2VtcHR5JztcbiAgfTtcblxuICB2YXIgY2hlY2tGdWxsTGluZSA9IGZ1bmN0aW9uIChsaW5lKSB7XG4gICAgdmFyIGlzQWxsU2FtZSA9IGZhbHNlO1xuXG4gICAgaWYgKFxuICAgICAgZ2V0Q2VsbE5hbWUobGluZVswXSkgIT09ICdlbXB0eSdcbiAgICAgICYmIGdldENlbGxOYW1lKGxpbmVbMF0pID09PSBnZXRDZWxsTmFtZShsaW5lWzFdKVxuICAgICAgJiYgZ2V0Q2VsbE5hbWUobGluZVswXSkgPT09IGdldENlbGxOYW1lKGxpbmVbMl0pXG4gICAgKSB7XG4gICAgICB3aW5uZXIgPSBnZXRDZWxsTmFtZShsaW5lWzBdKTtcbiAgICAgIGlzQWxsU2FtZSA9IHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGlzQWxsU2FtZTtcbiAgfTtcblxuICB2YXIgY2hlY2tFbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGlzRW5kID0gZmFsc2U7XG5cbiAgICBMSU5FUy5mb3JFYWNoKGZ1bmN0aW9uIChsaW5lKSB7XG4gICAgICBpZiAoY2hlY2tGdWxsTGluZShsaW5lKSAmJiAhaXNFbmQpIHtcbiAgICAgICAgaXNFbmQgPSB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGlzRW5kO1xuICB9O1xuXG4gIHZhciBnZXRQb3NzaWJsZUxpbmVDZWxsID0gZnVuY3Rpb24gKGxpbmUsIHBsYXllcikge1xuICAgIGlmIChcbiAgICAgIGdldENlbGxOYW1lKGxpbmVbMF0pID09PSBwbGF5ZXJcbiAgICAgICYmIGdldENlbGxOYW1lKGxpbmVbMF0pID09PSBnZXRDZWxsTmFtZShsaW5lWzFdKVxuICAgICAgJiYgZ2V0Q2VsbE5hbWUobGluZVsyXSkgPT09ICdlbXB0eSdcbiAgICApIHtcbiAgICAgIHJldHVybiBsaW5lWzJdO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIGdldENlbGxOYW1lKGxpbmVbMF0pID09PSBwbGF5ZXJcbiAgICAgICYmIGdldENlbGxOYW1lKGxpbmVbMF0pID09PSBnZXRDZWxsTmFtZShsaW5lWzJdKVxuICAgICAgJiYgZ2V0Q2VsbE5hbWUobGluZVsxXSkgPT09ICdlbXB0eSdcbiAgICApIHtcbiAgICAgIHJldHVybiBsaW5lWzFdO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIGdldENlbGxOYW1lKGxpbmVbMV0pID09PSBwbGF5ZXJcbiAgICAgICYmIGdldENlbGxOYW1lKGxpbmVbMV0pID09PSBnZXRDZWxsTmFtZShsaW5lWzJdKVxuICAgICAgJiYgZ2V0Q2VsbE5hbWUobGluZVswXSkgPT09ICdlbXB0eSdcbiAgICApIHtcbiAgICAgIHJldHVybiBsaW5lWzBdO1xuICAgIH1cblxuICAgIHJldHVybiAtMTtcbiAgfTtcblxuICB2YXIgZ2V0UG9zc2libGVGaWVsZENlbGwgPSBmdW5jdGlvbiAocGxheWVyKSB7XG4gICAgdmFyIGNlbGwgPSAtMTtcblxuICAgIExJTkVTLmZvckVhY2goZnVuY3Rpb24gKGxpbmUpIHtcbiAgICAgIHZhciBjdXJyZW50Q2VsbCA9IGdldFBvc3NpYmxlTGluZUNlbGwobGluZSwgcGxheWVyKTtcblxuICAgICAgaWYgKGN1cnJlbnRDZWxsICE9PSAtMSAmJiBjZWxsID09PSAtMSkge1xuICAgICAgICBjZWxsID0gY3VycmVudENlbGw7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gY2VsbDtcbiAgfTtcblxuICB2YXIgY29tcHV0ZXJNb3ZlID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBkYW5nZXJOdW0gPSBnZXRQb3NzaWJsZUZpZWxkQ2VsbChodW1hbik7XG4gICAgdmFyIHdpbm5pbmdOdW0gPSBnZXRQb3NzaWJsZUZpZWxkQ2VsbChjb21wdXRlcik7XG4gICAgdmFyIHJhbmRvbU51bSA9IC0xO1xuXG4gICAgaXNEZWxheSA9IGZhbHNlO1xuXG4gICAgaWYgKHdpbm5pbmdOdW0gIT09IC0xKSB7XG4gICAgICBjZWxsc1t3aW5uaW5nTnVtXS5hcHBlbmRDaGlsZChyZW5kZXIoKSk7XG4gICAgICBzdGVwICs9IDE7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGRhbmdlck51bSAhPT0gLTEpIHtcbiAgICAgIGNlbGxzW2Rhbmdlck51bV0uYXBwZW5kQ2hpbGQocmVuZGVyKCkpO1xuICAgICAgc3RlcCArPSAxO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHdoaWxlIChyYW5kb21OdW0gPT09IC0xKSB7XG4gICAgICBudW0gPSBnZXRSYW5kb21OdW1iZXIoMCwgOCk7XG4gICAgICByYW5kb21OdW0gPSBjZWxsc1tudW1dLmZpcnN0Q2hpbGQgPyAtMSA6IG51bTtcbiAgICB9XG5cbiAgICBjZWxsc1tyYW5kb21OdW1dLmFwcGVuZENoaWxkKHJlbmRlcigpKTtcbiAgICBzdGVwICs9IDE7XG5cbiAgICBpZiAoY2hlY2tFbmQoKSkge1xuICAgICAgc2hvd01lc3NhZ2UoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoc3RlcCA9PT0gOSkge1xuICAgICAgc2hvd01lc3NhZ2UoKTtcbiAgICB9XG4gIH1cblxuICB2YXIgc2hvd01lc3NhZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgbWVzc2FnZS5jbGFzc05hbWUgPSAnZ2FtZW92ZXJfX3RleHQnO1xuICAgIG1lc3NhZ2UuY2xhc3NMaXN0LmFkZCh3aW5uZXIpO1xuICAgIG1lc3NhZ2UudGV4dENvbnRlbnQgPSBXSU5fTUVTU0FHRVt3aW5uZXJdO1xuICAgIGdhbWVvdmVyLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTtcbiAgfTtcblxuICB2YXIgY2xlYXJGaWVsZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBjZWxscy5mb3JFYWNoKGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICBpZiAoY2VsbC5maXJzdENoaWxkKSB7XG4gICAgICAgIGNlbGwucmVtb3ZlQ2hpbGQoY2VsbC5maXJzdENoaWxkKTtcbiAgICAgIH1cbiAgICB9KVxuICB9O1xuXG4gIHZhciBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgY2xlYXJGaWVsZCgpO1xuICAgIGdhbWVvdmVyLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTtcbiAgICBtZXNzYWdlLnRleHRDb250ZW50ID0gJyc7XG4gICAgaXNDcm9zcyA9IHRydWU7XG4gICAgd2lubmVyID0gJ3RpZSc7XG4gICAgc3RlcCA9IDA7XG4gICAgaXNEZWxheSA9IGZhbHNlO1xuXG4gICAgaWYgKGlzUmluZ1BsYXllcikge1xuICAgICAgc2V0VGltZW91dChjb21wdXRlck1vdmUsIERFTEFZKTtcbiAgICB9XG4gIH07XG5cbiAgdmFyIG9uTWVudUNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgIGlzUmluZ1BsYXllciA9IGZhbHNlO1xuICAgIGlzTXVsdGlwbGF5ZXIgPSBmYWxzZTtcbiAgICBnYW1lb3Zlci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG4gICAgY2xlYXJGaWVsZCgpO21lc3NhZ2UudGV4dENvbnRlbnQgPSAnJztcbiAgICBpc0Nyb3NzID0gdHJ1ZTtcbiAgICB3aW5uZXIgPSAndGllJztcbiAgICBzdGVwID0gMDtcbiAgICBpc0RlbGF5ID0gZmFsc2U7XG4gICAgY29tcHV0ZXIgPSAncmluZyc7XG4gICAgaHVtYW4gPSAnY3Jvc3MnO1xuXG4gICAgYmVnaW4uY2xhc3NMaXN0LmFkZCgnc2hvdycpO1xuICB9XG5cbiAgdmFyIG9uRmllbGRDbGljayA9IGZ1bmN0aW9uIChldnQpIHtcbiAgICB2YXIgdGFyZ2V0ID0gZXZ0LnRhcmdldDtcblxuICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdmaWVsZF9fY2VsbCcpICYmICFpc0RlbGF5KSB7XG4gICAgICBpc0RlbGF5ID0gaXNNdWx0aXBsYXllciA/IGZhbHNlIDogdHJ1ZTtcbiAgICAgIHRhcmdldC5hcHBlbmRDaGlsZChyZW5kZXIoKSk7XG4gICAgICBzdGVwICs9IDE7XG5cbiAgICAgIGlmIChjaGVja0VuZCgpKSB7XG4gICAgICAgIHNob3dNZXNzYWdlKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKHN0ZXAgPT09IDkpIHtcbiAgICAgICAgc2hvd01lc3NhZ2UoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWlzTXVsdGlwbGF5ZXIpIHtcbiAgICAgICAgc2V0VGltZW91dChjb21wdXRlck1vdmUsIERFTEFZKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBiZWdpbi5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7XG4gIG11bHRpcGxheWVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25NdWx0aXBsYXllckNsaWNrKTtcbiAgY3Jvc3NQbGF5ZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNyb3NzUGxheWVyQ2xpY2spO1xuICByaW5nUGxheWVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25SaW5nUGxheWVyQ2xpY2spO1xuICBmaWVsZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uRmllbGRDbGljayk7XG4gIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgbWVudS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uTWVudUNsaWNrKTtcbn0pKCk7XG4iXX0=
