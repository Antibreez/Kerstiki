!function(){var e=document.querySelector(".field"),t=document.querySelectorAll(".field__cell"),n=document.querySelector(".gameover"),o=document.querySelector(".gameover__text"),r=document.querySelector(".gameover__close"),i=document.querySelector(".gameover__to-start"),c=document.querySelector(".begin"),s=document.querySelector(".begin__button--multiplayer"),u=document.querySelector(".begin__button--one-player-cross"),l=document.querySelector(".begin__button--one-player-ring"),d=document.querySelector("#cross").content.querySelector(".cross"),a=document.querySelector("#ring").content.querySelector(".ring"),f=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],m=!1,v={cross:"Выиграли крестики!",ring:"Выиграли нолики!",tie:"Ничья!"},h="tie",y="ring",_="cross",g=!0,L=!1,p=!1,q=0,S=function(){var e=g?d.cloneNode(!0):a.cloneNode(!0);return g=!g,e},C=function(e){return t[e].firstChild?t[e].firstChild.classList[0]:"empty"},E=function(){var e=!1;return f.forEach((function(t){(function(e){var t=!1;return"empty"!==C(e[0])&&C(e[0])===C(e[1])&&C(e[0])===C(e[2])&&(h=C(e[0]),t=!0),t})(t)&&!e&&(e=!0)})),e},w=function(e){var t=-1;return f.forEach((function(n){var o=function(e,t){return C(e[0])===t&&C(e[0])===C(e[1])&&"empty"===C(e[2])?e[2]:C(e[0])===t&&C(e[0])===C(e[2])&&"empty"===C(e[1])?e[1]:C(e[1])===t&&C(e[1])===C(e[2])&&"empty"===C(e[0])?e[0]:-1}(n,e);-1!==o&&-1===t&&(t=o)})),t},b=function(){var e,n,o=w(_),r=w(y),i=-1;if(m=!1,-1!==r)return t[r].appendChild(S()),q+=1,E()?void k():void(9===q&&k());if(-1!==o)return t[o].appendChild(S()),q+=1,E()?void k():void(9===q&&k());for(;-1===i;)num=(e=0,n=8,Math.floor(Math.random()*(n-e+1))+e),i=t[num].firstChild?-1:num;t[i].appendChild(S()),q+=1,(E()||9===q)&&k()},k=function(){o.className="gameover__text",o.classList.add(h),o.textContent=v[h],n.classList.add("show")},x=function(){t.forEach((function(e){e.firstChild&&e.removeChild(e.firstChild)}))};c.classList.add("show"),s.addEventListener("click",(function(){c.classList.remove("show"),L=!0})),u.addEventListener("click",(function(){c.classList.remove("show")})),l.addEventListener("click",(function(){c.classList.remove("show"),p=!0,y="cross",_="ring",setTimeout(b,500)})),e.addEventListener("click",(function(e){var t=e.target;if(t.classList.contains("field__cell")&&!m){if(m=!L,t.appendChild(S()),q+=1,E())return void k();if(9===q)return void k();L||setTimeout(b,500)}})),r.addEventListener("click",(function(){x(),n.classList.remove("show"),o.textContent="",g=!0,h="tie",q=0,m=!1,p&&setTimeout(b,500)})),i.addEventListener("click",(function(){p=!1,L=!1,n.classList.remove("show"),x(),o.textContent="",g=!0,h="tie",q=0,m=!1,y="ring",_="cross",c.classList.add("show")}))}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiZmllbGQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjZWxscyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJnYW1lb3ZlciIsIm1lc3NhZ2UiLCJjbG9zZSIsIm1lbnUiLCJiZWdpbiIsIm11bHRpcGxheWVyIiwiY3Jvc3NQbGF5ZXIiLCJyaW5nUGxheWVyIiwiY3Jvc3NUZW1wbGF0ZSIsImNvbnRlbnQiLCJyaW5nVGVtcGxhdGUiLCJMSU5FUyIsImlzRGVsYXkiLCJXSU5fTUVTU0FHRSIsImNyb3NzIiwicmluZyIsInRpZSIsIndpbm5lciIsImNvbXB1dGVyIiwiaHVtYW4iLCJpc0Nyb3NzIiwiaXNNdWx0aXBsYXllciIsImlzUmluZ1BsYXllciIsInN0ZXAiLCJyZW5kZXIiLCJub2RlIiwiY2xvbmVOb2RlIiwiZ2V0Q2VsbE5hbWUiLCJudW0iLCJmaXJzdENoaWxkIiwiY2xhc3NMaXN0IiwiY2hlY2tFbmQiLCJpc0VuZCIsImZvckVhY2giLCJsaW5lIiwiaXNBbGxTYW1lIiwiY2hlY2tGdWxsTGluZSIsImdldFBvc3NpYmxlRmllbGRDZWxsIiwicGxheWVyIiwiY2VsbCIsImN1cnJlbnRDZWxsIiwiZ2V0UG9zc2libGVMaW5lQ2VsbCIsImNvbXB1dGVyTW92ZSIsIm1pbiIsIm1heCIsImRhbmdlck51bSIsIndpbm5pbmdOdW0iLCJyYW5kb21OdW0iLCJhcHBlbmRDaGlsZCIsInNob3dNZXNzYWdlIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiY2xhc3NOYW1lIiwiYWRkIiwidGV4dENvbnRlbnQiLCJjbGVhckZpZWxkIiwicmVtb3ZlQ2hpbGQiLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlIiwic2V0VGltZW91dCIsImV2dCIsInRhcmdldCIsImNvbnRhaW5zIl0sIm1hcHBpbmdzIjoiQ0FBQSxXQUNBLElBQUFBLEVBQUFDLFNBQUFDLGNBQUEsVUFDQUMsRUFBQUYsU0FBQUcsaUJBQUEsZ0JBQ0FDLEVBQUFKLFNB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QXZDLEVBQUF1RCxpQkFBQSxTQTdDQSxXQUNBcEMsR0FBQSxFQUNBRCxHQUFBLEVBQ0FyQixFQUFBOEIsVUFBQTZCLE9BQUEsUUFDQUgsSUFBQXZELEVBQUFzRCxZQUFBLEdBQ0FuQyxHQUFBLEVBQ0FILEVBQUEsTUFDQU0sRUFBQSxFQUNBWCxHQUFBLEVBQ0FNLEVBQUEsT0FDQUMsRUFBQSxRQUVBZixFQUFBMEIsVUFBQXdCLElBQUEsV0E1UEEiLCJmaWxlIjoic2NyaXB0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XG4gIHZhciBmaWVsZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5maWVsZCcpO1xuICB2YXIgY2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZmllbGRfX2NlbGwnKTtcbiAgdmFyIGdhbWVvdmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdhbWVvdmVyJyk7XG4gIHZhciBtZXNzYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdhbWVvdmVyX190ZXh0Jyk7XG4gIHZhciBjbG9zZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5nYW1lb3Zlcl9fY2xvc2UnKTtcbiAgdmFyIG1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ2FtZW92ZXJfX3RvLXN0YXJ0Jyk7XG5cbiAgdmFyIGJlZ2luID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJlZ2luJyk7XG4gIHZhciBtdWx0aXBsYXllciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5iZWdpbl9fYnV0dG9uLS1tdWx0aXBsYXllcicpO1xuICB2YXIgY3Jvc3NQbGF5ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmVnaW5fX2J1dHRvbi0tb25lLXBsYXllci1jcm9zcycpO1xuICB2YXIgcmluZ1BsYXllciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5iZWdpbl9fYnV0dG9uLS1vbmUtcGxheWVyLXJpbmcnKTtcblxuICB2YXIgY3Jvc3NUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjcm9zcycpLmNvbnRlbnQucXVlcnlTZWxlY3RvcignLmNyb3NzJyk7XG4gIHZhciByaW5nVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcmluZycpLmNvbnRlbnQucXVlcnlTZWxlY3RvcignLnJpbmcnKTtcblxuICB2YXIgTElORVMgPSBbXG4gICAgWzAsIDEsIDJdLFxuICAgIFszLCA0LCA1XSxcbiAgICBbNiwgNywgOF0sXG4gICAgWzAsIDMsIDZdLFxuICAgIFsxLCA0LCA3XSxcbiAgICBbMiwgNSwgOF0sXG4gICAgWzAsIDQsIDhdLFxuICAgIFsyLCA0LCA2XVxuICBdO1xuXG4gIHZhciBERUxBWSA9IDUwMDtcblxuICB2YXIgaXNEZWxheSA9IGZhbHNlO1xuXG4gIHZhciBXSU5fTUVTU0FHRSA9IHtcbiAgICAnY3Jvc3MnOiAn0JLRi9C40LPRgNCw0LvQuCDQutGA0LXRgdGC0LjQutC4IScsXG4gICAgJ3JpbmcnOiAn0JLRi9C40LPRgNCw0LvQuCDQvdC+0LvQuNC60LghJyxcbiAgICAndGllJzogJ9Cd0LjRh9GM0Y8hJ1xuICB9O1xuXG4gIHZhciB3aW5uZXIgPSAndGllJztcbiAgdmFyIGNvbXB1dGVyID0gJ3JpbmcnO1xuICB2YXIgaHVtYW4gPSAnY3Jvc3MnO1xuICB2YXIgaXNDcm9zcyA9IHRydWU7XG4gIHZhciBpc011bHRpcGxheWVyID0gZmFsc2U7XG4gIHZhciBpc1JpbmdQbGF5ZXIgPSBmYWxzZTtcbiAgdmFyIHN0ZXAgPSAwO1xuXG4gIHZhciBnZXRSYW5kb21OdW1iZXIgPSBmdW5jdGlvbiAobWluLCBtYXgpIHtcbiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjtcbiAgfTtcblxuICB2YXIgb25NdWx0aXBsYXllckNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgIGJlZ2luLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTtcbiAgICBpc011bHRpcGxheWVyID0gdHJ1ZTtcbiAgfTtcblxuICB2YXIgb25Dcm9zc1BsYXllckNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgIGJlZ2luLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTtcbiAgfTtcblxuICB2YXIgb25SaW5nUGxheWVyQ2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgYmVnaW4uY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpO1xuICAgIGlzUmluZ1BsYXllciA9IHRydWU7XG4gICAgY29tcHV0ZXIgPSAnY3Jvc3MnO1xuICAgIGh1bWFuID0gJ3JpbmcnO1xuICAgIHNldFRpbWVvdXQoY29tcHV0ZXJNb3ZlLCBERUxBWSk7XG4gIH07XG5cbiAgdmFyIGNoYW5nZVBsYXllciA9IGZ1bmN0aW9uICgpIHtcbiAgICBpc0Nyb3NzID0gaXNDcm9zcyA/IGZhbHNlIDogdHJ1ZTtcbiAgfTtcblxuICB2YXIgcmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBub2RlID0gaXNDcm9zcyA/XG4gICAgICBjcm9zc1RlbXBsYXRlLmNsb25lTm9kZSh0cnVlKSA6XG4gICAgICByaW5nVGVtcGxhdGUuY2xvbmVOb2RlKHRydWUpO1xuICAgIGNoYW5nZVBsYXllcigpO1xuXG4gICAgcmV0dXJuIG5vZGU7XG4gIH07XG5cbiAgdmFyIGdldENlbGxOYW1lID0gZnVuY3Rpb24gKG51bSkge1xuICAgIHJldHVybiBjZWxsc1tudW1dLmZpcnN0Q2hpbGQgP1xuICAgICAgY2VsbHNbbnVtXS5maXJzdENoaWxkLmNsYXNzTGlzdFswXSA6XG4gICAgICAnZW1wdHknO1xuICB9O1xuXG4gIHZhciBjaGVja0Z1bGxMaW5lID0gZnVuY3Rpb24gKGxpbmUpIHtcbiAgICB2YXIgaXNBbGxTYW1lID0gZmFsc2U7XG5cbiAgICBpZiAoXG4gICAgICBnZXRDZWxsTmFtZShsaW5lWzBdKSAhPT0gJ2VtcHR5J1xuICAgICAgJiYgZ2V0Q2VsbE5hbWUobGluZVswXSkgPT09IGdldENlbGxOYW1lKGxpbmVbMV0pXG4gICAgICAmJiBnZXRDZWxsTmFtZShsaW5lWzBdKSA9PT0gZ2V0Q2VsbE5hbWUobGluZVsyXSlcbiAgICApIHtcbiAgICAgIHdpbm5lciA9IGdldENlbGxOYW1lKGxpbmVbMF0pO1xuICAgICAgaXNBbGxTYW1lID0gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gaXNBbGxTYW1lO1xuICB9O1xuXG4gIHZhciBjaGVja0VuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgaXNFbmQgPSBmYWxzZTtcblxuICAgIExJTkVTLmZvckVhY2goZnVuY3Rpb24gKGxpbmUpIHtcbiAgICAgIGlmIChjaGVja0Z1bGxMaW5lKGxpbmUpICYmICFpc0VuZCkge1xuICAgICAgICBpc0VuZCA9IHRydWU7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gaXNFbmQ7XG4gIH07XG5cbiAgdmFyIGdldFBvc3NpYmxlTGluZUNlbGwgPSBmdW5jdGlvbiAobGluZSwgcGxheWVyKSB7XG4gICAgaWYgKFxuICAgICAgZ2V0Q2VsbE5hbWUobGluZVswXSkgPT09IHBsYXllclxuICAgICAgJiYgZ2V0Q2VsbE5hbWUobGluZVswXSkgPT09IGdldENlbGxOYW1lKGxpbmVbMV0pXG4gICAgICAmJiBnZXRDZWxsTmFtZShsaW5lWzJdKSA9PT0gJ2VtcHR5J1xuICAgICkge1xuICAgICAgcmV0dXJuIGxpbmVbMl07XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgZ2V0Q2VsbE5hbWUobGluZVswXSkgPT09IHBsYXllclxuICAgICAgJiYgZ2V0Q2VsbE5hbWUobGluZVswXSkgPT09IGdldENlbGxOYW1lKGxpbmVbMl0pXG4gICAgICAmJiBnZXRDZWxsTmFtZShsaW5lWzFdKSA9PT0gJ2VtcHR5J1xuICAgICkge1xuICAgICAgcmV0dXJuIGxpbmVbMV07XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgZ2V0Q2VsbE5hbWUobGluZVsxXSkgPT09IHBsYXllclxuICAgICAgJiYgZ2V0Q2VsbE5hbWUobGluZVsxXSkgPT09IGdldENlbGxOYW1lKGxpbmVbMl0pXG4gICAgICAmJiBnZXRDZWxsTmFtZShsaW5lWzBdKSA9PT0gJ2VtcHR5J1xuICAgICkge1xuICAgICAgcmV0dXJuIGxpbmVbMF07XG4gICAgfVxuXG4gICAgcmV0dXJuIC0xO1xuICB9O1xuXG4gIHZhciBnZXRQb3NzaWJsZUZpZWxkQ2VsbCA9IGZ1bmN0aW9uIChwbGF5ZXIpIHtcbiAgICB2YXIgY2VsbCA9IC0xO1xuXG4gICAgTElORVMuZm9yRWFjaChmdW5jdGlvbiAobGluZSkge1xuICAgICAgdmFyIGN1cnJlbnRDZWxsID0gZ2V0UG9zc2libGVMaW5lQ2VsbChsaW5lLCBwbGF5ZXIpO1xuXG4gICAgICBpZiAoY3VycmVudENlbGwgIT09IC0xICYmIGNlbGwgPT09IC0xKSB7XG4gICAgICAgIGNlbGwgPSBjdXJyZW50Q2VsbDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBjZWxsO1xuICB9O1xuXG4gIHZhciBjb21wdXRlck1vdmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGRhbmdlck51bSA9IGdldFBvc3NpYmxlRmllbGRDZWxsKGh1bWFuKTtcbiAgICB2YXIgd2lubmluZ051bSA9IGdldFBvc3NpYmxlRmllbGRDZWxsKGNvbXB1dGVyKTtcbiAgICB2YXIgcmFuZG9tTnVtID0gLTE7XG5cbiAgICBpc0RlbGF5ID0gZmFsc2U7XG5cbiAgICBpZiAod2lubmluZ051bSAhPT0gLTEpIHtcbiAgICAgIGNlbGxzW3dpbm5pbmdOdW1dLmFwcGVuZENoaWxkKHJlbmRlcigpKTtcbiAgICAgIHN0ZXAgKz0gMTtcblxuICAgICAgaWYgKGNoZWNrRW5kKCkpIHtcbiAgICAgICAgc2hvd01lc3NhZ2UoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoc3RlcCA9PT0gOSkge1xuICAgICAgICBzaG93TWVzc2FnZSgpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGRhbmdlck51bSAhPT0gLTEpIHtcbiAgICAgIGNlbGxzW2Rhbmdlck51bV0uYXBwZW5kQ2hpbGQocmVuZGVyKCkpO1xuICAgICAgc3RlcCArPSAxO1xuXG4gICAgICBpZiAoY2hlY2tFbmQoKSkge1xuICAgICAgICBzaG93TWVzc2FnZSgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChzdGVwID09PSA5KSB7XG4gICAgICAgIHNob3dNZXNzYWdlKCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB3aGlsZSAocmFuZG9tTnVtID09PSAtMSkge1xuICAgICAgbnVtID0gZ2V0UmFuZG9tTnVtYmVyKDAsIDgpO1xuICAgICAgcmFuZG9tTnVtID0gY2VsbHNbbnVtXS5maXJzdENoaWxkID8gLTEgOiBudW07XG4gICAgfVxuXG4gICAgY2VsbHNbcmFuZG9tTnVtXS5hcHBlbmRDaGlsZChyZW5kZXIoKSk7XG4gICAgc3RlcCArPSAxO1xuXG4gICAgaWYgKGNoZWNrRW5kKCkpIHtcbiAgICAgIHNob3dNZXNzYWdlKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHN0ZXAgPT09IDkpIHtcbiAgICAgIHNob3dNZXNzYWdlKCk7XG4gICAgfVxuICB9XG5cbiAgdmFyIHNob3dNZXNzYWdlID0gZnVuY3Rpb24gKCkge1xuICAgIG1lc3NhZ2UuY2xhc3NOYW1lID0gJ2dhbWVvdmVyX190ZXh0JztcbiAgICBtZXNzYWdlLmNsYXNzTGlzdC5hZGQod2lubmVyKTtcbiAgICBtZXNzYWdlLnRleHRDb250ZW50ID0gV0lOX01FU1NBR0Vbd2lubmVyXTtcbiAgICBnYW1lb3Zlci5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7XG4gIH07XG5cbiAgdmFyIGNsZWFyRmllbGQgPSBmdW5jdGlvbiAoKSB7XG4gICAgY2VsbHMuZm9yRWFjaChmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgaWYgKGNlbGwuZmlyc3RDaGlsZCkge1xuICAgICAgICBjZWxsLnJlbW92ZUNoaWxkKGNlbGwuZmlyc3RDaGlsZCk7XG4gICAgICB9XG4gICAgfSlcbiAgfTtcblxuICB2YXIgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgIGNsZWFyRmllbGQoKTtcbiAgICBnYW1lb3Zlci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG4gICAgbWVzc2FnZS50ZXh0Q29udGVudCA9ICcnO1xuICAgIGlzQ3Jvc3MgPSB0cnVlO1xuICAgIHdpbm5lciA9ICd0aWUnO1xuICAgIHN0ZXAgPSAwO1xuICAgIGlzRGVsYXkgPSBmYWxzZTtcblxuICAgIGlmIChpc1JpbmdQbGF5ZXIpIHtcbiAgICAgIHNldFRpbWVvdXQoY29tcHV0ZXJNb3ZlLCBERUxBWSk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBvbk1lbnVDbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICBpc1JpbmdQbGF5ZXIgPSBmYWxzZTtcbiAgICBpc011bHRpcGxheWVyID0gZmFsc2U7XG4gICAgZ2FtZW92ZXIuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpO1xuICAgIGNsZWFyRmllbGQoKTttZXNzYWdlLnRleHRDb250ZW50ID0gJyc7XG4gICAgaXNDcm9zcyA9IHRydWU7XG4gICAgd2lubmVyID0gJ3RpZSc7XG4gICAgc3RlcCA9IDA7XG4gICAgaXNEZWxheSA9IGZhbHNlO1xuICAgIGNvbXB1dGVyID0gJ3JpbmcnO1xuICAgIGh1bWFuID0gJ2Nyb3NzJztcblxuICAgIGJlZ2luLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTtcbiAgfVxuXG4gIHZhciBvbkZpZWxkQ2xpY2sgPSBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgdmFyIHRhcmdldCA9IGV2dC50YXJnZXQ7XG5cbiAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZmllbGRfX2NlbGwnKSAmJiAhaXNEZWxheSkge1xuICAgICAgaXNEZWxheSA9IGlzTXVsdGlwbGF5ZXIgPyBmYWxzZSA6IHRydWU7XG4gICAgICB0YXJnZXQuYXBwZW5kQ2hpbGQocmVuZGVyKCkpO1xuICAgICAgc3RlcCArPSAxO1xuXG4gICAgICBpZiAoY2hlY2tFbmQoKSkge1xuICAgICAgICBzaG93TWVzc2FnZSgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChzdGVwID09PSA5KSB7XG4gICAgICAgIHNob3dNZXNzYWdlKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKCFpc011bHRpcGxheWVyKSB7XG4gICAgICAgIHNldFRpbWVvdXQoY29tcHV0ZXJNb3ZlLCBERUxBWSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgYmVnaW4uY2xhc3NMaXN0LmFkZCgnc2hvdycpO1xuICBtdWx0aXBsYXllci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uTXVsdGlwbGF5ZXJDbGljayk7XG4gIGNyb3NzUGxheWVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25Dcm9zc1BsYXllckNsaWNrKTtcbiAgcmluZ1BsYXllci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uUmluZ1BsYXllckNsaWNrKTtcbiAgZmllbGQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkZpZWxkQ2xpY2spO1xuICBjbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xvc2VDbGljayk7XG4gIG1lbnUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbk1lbnVDbGljayk7XG59KSgpO1xuIl19
